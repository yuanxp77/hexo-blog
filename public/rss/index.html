<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            line-height: 1.4;
            font-size: 14px;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .articles-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .article {
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 12px;
            background: #fafafa;
            transition: box-shadow 0.2s;
        }
        .article:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .article-title {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 6px;
            line-height: 1.3;
        }
        .article-title a {
            color: #333;
            text-decoration: none;
        }
        .article-title a:hover {
            color: #007cba;
            text-decoration: underline;
        }
        .article-meta {
            color: #666;
            font-size: 12px;
            margin-bottom: 6px;
        }
        .article-source {
            display: inline-block;
            background: #007cba;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            margin-right: 8px;
        }
        .article-description {
            color: #555;
            margin-bottom: 6px;
            font-size: 13px;
            line-height: 1.3;
        }
        .article-link {
            font-size: 12px;
        }
        .article-link a {
            color: #007cba;
            text-decoration: none;
        }
        .article-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="status">正在加载所有RSS源...</div>
    <div id="articles" class="articles-container"></div>

    <script>
        // 由于浏览器的CORS限制，我们需要使用代理服务来获取RSS内容
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        
        // 预设的RSS源配置
        const RSS_SOURCES = [
            { name: '少数派', url: 'https://sspai.com/feed', color: '#d23f31' },
            { name: '美团技术团队', url: 'https://tech.meituan.com/atom.xml', color: '#ffc107' },
            { name: '阿里云开发者', url: 'https://developer.aliyun.com/rss', color: '#ff6a00' },
            { name: '腾讯技术工程', url: 'https://cloud.tencent.com/developer/column/1002/rss', color: '#00a4ff' },
            { name: '字节跳动技术团队', url: 'https://techblog.toutiao.com/feed/', color: '#1890ff' },
            { name: '阮一峰周刊', url: 'https://www.ruanyifeng.com/blog/atom.xml', color: '#4caf50' },
            { name: '酷壳CoolShell', url: 'https://coolshell.cn/feed', color: '#795548' },
            { name: 'InfoQ中文', url: 'https://www.infoq.cn/feed', color: '#1976d2' },
            { name: 'Hacker News', url: 'https://hnrss.org/frontpage', color: '#ff6600' },
            { name: 'Dev.to', url: 'https://dev.to/feed', color: '#0a0a0a' }
        ];
        
        let allArticles = [];
        let loadedCount = 0;
        let loadResults = [];
        
        // 加载单个RSS源
        async function loadSingleRSS(source) {
            try {
                const response = await fetch(CORS_PROXY + encodeURIComponent(source.url));
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }
                
                const rssText = await response.text();
                const parser = new DOMParser();
                const rssDoc = parser.parseFromString(rssText, 'text/xml');
                
                if (rssDoc.querySelector('parsererror')) {
                    throw new Error('无效的RSS格式');
                }
                
                const items = rssDoc.querySelectorAll('item');
                const articles = [];
                
                if (items.length === 0) {
                    // 尝试Atom格式
                    const entries = rssDoc.querySelectorAll('entry');
                    entries.forEach(entry => {
                        const title = getTextContent(entry, 'title') || '无标题';
                        const link = entry.querySelector('link') ? entry.querySelector('link').getAttribute('href') || '#' : '#';
                        const description = getTextContent(entry, 'summary') || getTextContent(entry, 'content') || '';
                        const pubDate = getTextContent(entry, 'published') || getTextContent(entry, 'updated') || '';
                        const author = getTextContent(entry, 'author name') || '';
                        
                        // 清理描述内容，移除HTML标签
                        const cleanDescription = description.replace(/<[^>]*>/g, '').substring(0, 150);
                        
                        // 解析发布日期
                        let dateObj = new Date();
                        if (pubDate) {
                            try {
                                dateObj = new Date(pubDate);
                            } catch (e) {
                                dateObj = new Date();
                            }
                        }
                        
                        articles.push({
                            title,
                            link,
                            description: cleanDescription,
                            pubDate: dateObj,
                            author,
                            source: source.name,
                            sourceColor: source.color
                        });
                    });
                } else {
                    // RSS格式
                    items.forEach(item => {
                        const title = getTextContent(item, 'title') || '无标题';
                        const link = getTextContent(item, 'link') || '#';
                        const description = getTextContent(item, 'description') || '';
                        const pubDate = getTextContent(item, 'pubDate') || '';
                        const author = getTextContent(item, 'author') || getTextContent(item, 'dc:creator') || '';
                        
                        // 清理描述内容，移除HTML标签
                        const cleanDescription = description.replace(/<[^>]*>/g, '').substring(0, 150);
                        
                        // 解析发布日期
                        let dateObj = new Date();
                        if (pubDate) {
                            try {
                                dateObj = new Date(pubDate);
                            } catch (e) {
                                dateObj = new Date();
                            }
                        }
                        
                        articles.push({
                            title,
                            link,
                            description: cleanDescription,
                            pubDate: dateObj,
                            author,
                            source: source.name,
                            sourceColor: source.color
                        });
                    });
                }
                
                loadResults.push({ source: source.name, status: 'success', count: articles.length });
                return articles;
                
            } catch (error) {
                console.error(`加载 ${source.name} 失败:`, error);
                loadResults.push({ source: source.name, status: 'error', error: error.message });
                return [];
            }
        }
        
        // 加载所有RSS源
        async function loadAllRSS() {
            const statusDiv = document.getElementById('status');
            const articlesDiv = document.getElementById('articles');
            
            statusDiv.innerHTML = '正在加载所有RSS源...';
            articlesDiv.innerHTML = '';
            allArticles = [];
            loadedCount = 0;
            loadResults = [];
            
            // 并行加载所有RSS源
            const promises = RSS_SOURCES.map(source => loadSingleRSS(source));
            const results = await Promise.all(promises);
            
            // 合并所有文章
            results.forEach(articles => {
                allArticles = allArticles.concat(articles);
            });
            
            // 按发布时间排序（最新的在前）
            allArticles.sort((a, b) => b.pubDate - a.pubDate);
            
            // 显示文章
            displayArticles();
            
            // 显示加载状态
            const successCount = loadResults.filter(r => r.status === 'success').length;
            const errorCount = loadResults.filter(r => r.status === 'error').length;
            
            let statusHTML = `<div style="color: #4caf50;">成功加载 ${allArticles.length} 篇文章 (${successCount}/${RSS_SOURCES.length} 个源成功)</div>`;
            
            if (errorCount > 0) {
                statusHTML += '<div style="margin-top: 10px; font-size: 12px;"><strong>加载失败的源:</strong><br>';
                loadResults.filter(r => r.status === 'error').forEach(r => {
                    statusHTML += `<span style="color: #d32f2f;">• ${r.source}: ${r.error}</span><br>`;
                });
                statusHTML += '</div>';
            }
            
            statusDiv.innerHTML = statusHTML;
        }
        
        // 显示文章
        function displayArticles() {
            const articlesDiv = document.getElementById('articles');
            let articlesHTML = '';
            
            allArticles.forEach(article => {
                const formattedDate = article.pubDate.toLocaleDateString('zh-CN') + ' ' + 
                                    article.pubDate.toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
                
                articlesHTML += `
                    <div class="article">
                        <div class="article-title">
                            <a href="${article.link}" target="_blank" rel="noopener noreferrer">${article.title}</a>
                        </div>
                        <div class="article-meta">
                            <span class="article-source" style="background-color: ${article.sourceColor}">${article.source}</span>
                            ${formattedDate}
                            ${article.author ? ` | ${article.author}` : ''}
                        </div>
                        ${article.description ? `<div class="article-description">${article.description}${article.description.length >= 150 ? '...' : ''}</div>` : ''}
                        <div class="article-link">
                            <a href="${article.link}" target="_blank" rel="noopener noreferrer">阅读全文 →</a>
                        </div>
                    </div>
                `;
            });
            
            articlesDiv.innerHTML = articlesHTML;
        }
        
        function getTextContent(element, tagName) {
            const tag = element.querySelector(tagName);
            return tag ? tag.textContent.trim() : '';
        }
        
        // 页面加载时自动加载所有RSS源
        window.addEventListener('load', function() {
            loadAllRSS();
        });
    </script>
</body>
</html>
